# 测试日志（问题/状态/解决方案）

- 2025-10-15 前端保存无反应（预览接口未走代理）
  - 原因：axios 相对路径命中 vite 预览端口
  - 处理：新增 http.ts 集中客户端；预览/生产默认指向 5002；页面统一改用 http 实例
  - 状态：已解决

- 2025-10-15 登录页样式与交互不一致
  - 处理：隐藏顶部导航；正方形卡片；输入框统一；支持回车提交
  - 状态：已解决

- 2025-10-15 登录失败（跨域/Cookie）
  - 原因：后端 CORS 使用 *，withCredentials 失效
  - 处理：CORS 白名单本机端口并 supports_credentials；前端 http 开启 withCredentials
  - 状态：已解决，待回归

- 2025-10-15 顶部登录按钮不醒目
  - 处理：改为主按钮，圆角加大
  - 状态：已解决

> 规范：每条包含【原因】【处理】【状态】；回归通过后标记“已解决”。

---

- 2025-10-15 登录失败 500（/api/auth/login）
  - 原因：后端后台任务（APScheduler）在 Flask 应用上下文外访问数据库，抛出 “The current Flask app is not registered with this SQLAlchemy instance”，导致日志刷屏并干扰接口稳定性；同时偶发端口不一致导致跨域预检失败。
  - 处理：
    - 后端：`houduan/services/scheduler.py` 中统一使用 `with app.app_context():` 包裹数据库访问；初始化失败时仅 `warning` 并 `return`，不影响主线程；启动顺序改为在 app 初始化完成后再注册任务。
    - 前端：统一 `withCredentials`；接口基址固定为 `http://localhost:5002`（方案B），并在错误时弹窗展示服务端返回体和关键信息。
  - 状态：已修复，待回归

- 2025-10-15 Vite 预览端口冲突（5199 已被占用）
  - 原因：多次启动预览进程未释放端口
  - 处理：使用 `npm run preview -- --port 5174 --strictPort` 或关闭残留进程；文档固定使用 5174。
  - 状态：已解决

- 2025-10-15 CORS 允许来源与端口不匹配
  - 原因：后端 `Access-Control-Allow-Origin` 仅放行 `http://localhost:5173`，而前端实际运行在 5174/其它端口
  - 处理：后端改为白名单集合（5173/5174）并 `supports_credentials=True`；前端统一凭证模式。
  - 状态：已解决，待回归

